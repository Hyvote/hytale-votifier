---
phase: 04-vote-processing
plan: 02
type: execute
---

<objective>
Create VoteEvent and fire it via Hytale event system.

Purpose: Enable other plugins to listen for and respond to vote notifications through the standard Hytale event system.
Output: VoteEvent class extending Hytale Event, and integration to fire events from VoteServlet.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-vote-processing/04-01-SUMMARY.md

@src/main/java/org/hyvote/plugins/votifier/vote/Vote.java
@src/main/java/org/hyvote/plugins/votifier/http/VoteServlet.java
@src/main/java/org/hyvote/plugins/votifier/HytaleVotifierPlugin.java

**Tech stack available:** Hytale event system (com.hypixel.hytale), Vote record
**Established patterns:** Plugin reference in servlets, logging conventions
**Constraining decisions:**
- Phase 04-01: Vote record parsed and available in VoteServlet
- PROJECT.md: Events fire regardless of player online status
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create VoteEvent class</name>
  <files>src/main/java/org/hyvote/plugins/votifier/event/VoteEvent.java</files>
  <action>
Create a new `event` subpackage with VoteEvent class:

1. Extend com.hypixel.hytale.server.event.Event (or appropriate Hytale base event)
2. Include final Vote field (set in constructor)
3. Provide getter: getVote()
4. Include convenience getters: getServiceName(), getUsername(), getAddress(), getTimestamp()
5. Add Javadoc explaining this event fires when a valid vote is received, regardless of player online status

Note: Use whatever Hytale event base class is available. If unclear, use simplest Event implementation and document for future adjustment.
  </action>
  <verify>Code compiles without errors</verify>
  <done>VoteEvent extends Hytale Event base, contains Vote data, has appropriate getters</done>
</task>

<task type="auto">
  <name>Task 2: Fire VoteEvent from VoteServlet</name>
  <files>src/main/java/org/hyvote/plugins/votifier/http/VoteServlet.java</files>
  <action>
Update VoteServlet.doPost() to fire VoteEvent after successful parsing:

1. After parsing Vote, create new VoteEvent(vote)
2. Fire event via Hytale event manager:
   - Access via plugin.getServer().getEventManager() or equivalent
   - Call eventManager.call(voteEvent) or appropriate fire method
3. Log event firing if debug enabled: "Fired VoteEvent for %s from service %s"
4. Update success response to confirm event fired

Add imports for VoteEvent and event manager classes.

Note: If exact Hytale event API is unclear, use placeholder pattern that can be adjusted:
```java
// Fire vote event for other plugins to handle
VoteEvent voteEvent = new VoteEvent(vote);
// TODO: Verify event firing mechanism with actual Hytale API
plugin.fireEvent(voteEvent); // Add this method to plugin if needed
```
  </action>
  <verify>Code compiles without errors</verify>
  <done>VoteEvent fires when valid vote received, debug logging shows event fired</done>
</task>

<task type="auto">
  <name>Task 3: Add event firing helper to plugin (if needed)</name>
  <files>src/main/java/org/hyvote/plugins/votifier/HytaleVotifierPlugin.java</files>
  <action>
If Task 2 requires helper method, add to HytaleVotifierPlugin:

```java
/**
 * Fires an event via the Hytale event system.
 *
 * @param event the event to fire
 */
public void fireEvent(Event event) {
    // Use appropriate Hytale API to fire events
    // This may be: getServer().getEventManager().call(event)
    // Or: EventManager.get().fire(event)
    // Adjust based on available API
}
```

If event firing works directly in VoteServlet without helper, skip this task and mark as N/A.
  </action>
  <verify>Code compiles without errors (or N/A if skipped)</verify>
  <done>Event firing mechanism works, VoteEvent reaches listeners</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] VoteEvent class exists in event subpackage
- [ ] VoteEvent extends appropriate Hytale event base
- [ ] VoteServlet fires VoteEvent after successful vote parsing
- [ ] Events fire regardless of player online status (per PROJECT.md)
- [ ] All code compiles without syntax errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- VoteEvent contains full vote data
- Events fire through Hytale event system
- Other plugins can listen for VoteEvent
- Phase 4 (Vote Processing) complete
</success_criteria>

<output>
After completion, create `.planning/phases/04-vote-processing/04-02-SUMMARY.md`
</output>
