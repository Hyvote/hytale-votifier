---
phase: 01-project-foundation
plan: 02
type: execute
---

<objective>
Create plugin main class and JSON configuration loading system following Hytale plugin patterns.

Purpose: Establish the plugin entry point and configuration infrastructure for subsequent phases.
Output: Working plugin skeleton that can be loaded by Hytale server.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-project-foundation/01-01-SUMMARY.md

**Discovery findings (from nitrado/hytale-plugin-query reference):**

Plugin class pattern:
```java
public class QueryPlugin extends JavaPlugin {
    private WebServerPlugin webServerPlugin;

    public QueryPlugin(@Nonnull JavaPluginInit init) {
        super(init);
    }

    @Override
    protected void setup() {
        // Initialization logic
    }

    @Override
    protected void shutdown() {
        // Cleanup logic
    }
}
```

Key imports:
- com.hypixel.hytale.server.core.plugin.JavaPlugin
- com.hypixel.hytale.server.core.plugin.JavaPluginInit
- javax.annotation.Nonnull

WebServer integration (for later phases):
- PluginManager.get().getPlugin(new PluginIdentifier("Nitrado", "WebServer"))
- Cast to WebServerPlugin, call addServlet()
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create HytaleVotifierPlugin main class</name>
  <files>src/main/java/org/hyvote/plugins/votifier/HytaleVotifierPlugin.java</files>
  <action>
Create the main plugin class with:
- Package: org.hyvote.plugins.votifier
- Class: HytaleVotifierPlugin extends JavaPlugin
- Constructor: takes @Nonnull JavaPluginInit init, calls super(init)
- setup() method: logs startup message, calls loadConfig()
- shutdown() method: logs shutdown message (will add WebServer cleanup in Phase 3)
- loadConfig() private method: placeholder that logs "Loading configuration..." (actual config loading in Task 2)

Import statements:
- com.hypixel.hytale.server.core.plugin.JavaPlugin
- com.hypixel.hytale.server.core.plugin.JavaPluginInit
- javax.annotation.Nonnull
- java.util.logging.Level

Use getLogger().at(Level.INFO).log() pattern for logging, matching the reference project style.

Remove the .gitkeep file from the votifier package directory since we're adding real files now.
  </action>
  <verify>mvn compile -q succeeds (compiles without errors)</verify>
  <done>HytaleVotifierPlugin.java exists, compiles without errors, follows JavaPlugin pattern</done>
</task>

<task type="auto">
  <name>Task 2: Create VotifierConfig class for JSON configuration</name>
  <files>src/main/java/org/hyvote/plugins/votifier/VotifierConfig.java</files>
  <action>
Create configuration class with:
- Package: org.hyvote.plugins.votifier
- Record or class VotifierConfig with fields:
  - int port (default 8192 - standard Votifier port, though we use WebServer's port)
  - boolean debug (default false)
  - String keyPath (default "keys" - subdirectory for RSA keys)

Use a record for simplicity (Java 25 supports records):
```java
public record VotifierConfig(int port, boolean debug, String keyPath) {
    public static VotifierConfig defaults() {
        return new VotifierConfig(8192, false, "keys");
    }
}
```

Note: Actual file loading will be added in Phase 2 when we have the config directory structure. For now, just define the config structure.
  </action>
  <verify>mvn compile -q succeeds</verify>
  <done>VotifierConfig.java exists, compiles, defines configuration structure</done>
</task>

<task type="auto">
  <name>Task 3: Wire config loading into plugin</name>
  <files>src/main/java/org/hyvote/plugins/votifier/HytaleVotifierPlugin.java</files>
  <action>
Update HytaleVotifierPlugin to:
1. Add private field: VotifierConfig config
2. Add getter: public VotifierConfig getConfig() { return config; }
3. Update loadConfig() to: this.config = VotifierConfig.defaults()
4. Log the loaded config values in setup() after loadConfig()

The actual JSON file reading will be added in Phase 2 when we set up the keys directory. For now, use defaults.

Log format: "HytaleVotifier enabled - debug={}, keyPath={}"
  </action>
  <verify>mvn compile -q succeeds</verify>
  <done>Plugin initializes with default config, logs config values on startup</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] mvn compile succeeds without errors
- [ ] HytaleVotifierPlugin.java exists with setup/shutdown methods
- [ ] VotifierConfig.java exists with config fields
- [ ] Plugin logs startup message with config values
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Plugin compiles and has working config structure
- Phase 1 complete - foundation established
</success_criteria>

<output>
After completion, create `.planning/phases/01-project-foundation/01-02-SUMMARY.md`

Note: This completes Phase 1. Next phase is Phase 2: RSA Security.
</output>
