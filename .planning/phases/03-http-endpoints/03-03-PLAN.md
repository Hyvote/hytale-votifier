---
phase: 03-http-endpoints
plan: 03
type: execute
---

<objective>
Implement GET endpoint for status and health check.

Purpose: Provide voting sites and administrators a way to verify the server is running and retrieve the public key for vote encryption.
Output: StatusServlet that returns JSON with server status and Base64-encoded public key.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-http-endpoints/DISCOVERY.md
@.planning/phases/03-http-endpoints/03-02-SUMMARY.md

@src/main/java/org/hyvote/plugins/votifier/http/StatusServlet.java
@src/main/java/org/hyvote/plugins/votifier/crypto/RSAKeyManager.java

**Tech stack available:** jakarta.servlet.http, RSA key management
**Established patterns:** HttpServlet doGet pattern, X509 public key encoding
**Constraining decisions:**
- Public key in X509 DER format, Base64-encoded for voting sites
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement StatusServlet doGet handler</name>
  <files>src/main/java/org/hyvote/plugins/votifier/http/StatusServlet.java</files>
  <action>
Replace stub implementation with full doGet handler:

1. Set response Content-Type to "application/json"
2. Build JSON response manually (no external JSON library needed):

```
{
  "status": "ok",
  "version": "1.0.0",
  "serverType": "HytaleVotifier",
  "publicKey": "<base64-encoded-x509-der>"
}
```

3. Get public key: plugin.getKeyManager().getPublicKey()
4. If public key is null (keys not initialized), return 503 Service Unavailable with:
   {"status": "error", "message": "RSA keys not initialized"}
5. Encode public key bytes to Base64: Base64.getEncoder().encodeToString(publicKey.getEncoded())
6. Write JSON response using resp.getWriter().println()
7. Return 200 OK

Handle any exceptions with 500 Internal Server Error and log with stack trace.

Add imports:
- java.util.Base64
- java.security.PublicKey
  </action>
  <verify>Code compiles without errors (check syntax)</verify>
  <done>StatusServlet.doGet() returns JSON with status and public key</done>
</task>

<task type="auto">
  <name>Task 2: Add endpoint path constant and documentation</name>
  <files>src/main/java/org/hyvote/plugins/votifier/http/StatusServlet.java, src/main/java/org/hyvote/plugins/votifier/http/VoteServlet.java</files>
  <action>
Add Javadoc comments to both servlets documenting the endpoints:

StatusServlet:
```java
/**
 * HTTP endpoint for server status and public key retrieval.
 *
 * <p>Endpoint: GET /Hyvote/HytaleVotifier/status</p>
 *
 * <p>Returns JSON with server status and Base64-encoded X509 DER public key
 * for voting sites to use when encrypting vote payloads.</p>
 *
 * <p>Response format:</p>
 * <pre>
 * {
 *   "status": "ok",
 *   "version": "1.0.0",
 *   "serverType": "HytaleVotifier",
 *   "publicKey": "&lt;base64-x509-der&gt;"
 * }
 * </pre>
 */
```

VoteServlet:
```java
/**
 * HTTP endpoint for receiving encrypted vote notifications.
 *
 * <p>Endpoint: POST /Hyvote/HytaleVotifier/vote</p>
 *
 * <p>Accepts RSA-encrypted vote payloads from voting sites. The request body
 * should contain Base64-encoded encrypted data using the server's public key
 * (available via the /status endpoint).</p>
 *
 * <p>Response codes:</p>
 * <ul>
 *   <li>200 OK - Vote received and decrypted successfully</li>
 *   <li>400 Bad Request - Empty payload, invalid Base64, or decryption failed</li>
 *   <li>500 Internal Server Error - Unexpected server error</li>
 * </ul>
 */
```
  </action>
  <verify>Code compiles without errors (check syntax)</verify>
  <done>Both servlets have comprehensive Javadoc documenting endpoints, request/response formats</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] StatusServlet.doGet() returns JSON with status and public key
- [ ] Public key encoded as Base64 X509 DER
- [ ] 503 returned if keys not initialized
- [ ] Both servlets have Javadoc documentation
- [ ] All code compiles without syntax errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Status endpoint returns server info and public key
- Voting sites can retrieve public key for encryption
- Phase 3 (HTTP Endpoints) complete
</success_criteria>

<output>
After completion, create `.planning/phases/03-http-endpoints/03-03-SUMMARY.md`
</output>
