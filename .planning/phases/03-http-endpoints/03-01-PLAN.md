---
phase: 03-http-endpoints
plan: 01
type: execute
---

<objective>
Register servlets with WebServer plugin and establish HTTP endpoint infrastructure.

Purpose: Enable HTTP communication by integrating with the Nitrado WebServer plugin's servlet registration API.
Output: Plugin wired to WebServer with servlet lifecycle management (registration on startup, cleanup on shutdown).
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-http-endpoints/DISCOVERY.md
@.planning/phases/02-rsa-security/02-02-SUMMARY.md

@src/main/java/org/hyvote/plugins/votifier/HytaleVotifierPlugin.java

**Tech stack available:** maven, hytale-server-parent, nitrado-webserver
**Established patterns:** JavaPlugin lifecycle (setup/shutdown), crypto subpackage
**Constraining decisions:**
- Phase 01-01: Plugin group "Hyvote" for endpoint prefix consistency
- Endpoints mounted at `/Hyvote/HytaleVotifier/<path>`
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add WebServer plugin lookup and field</name>
  <files>src/main/java/org/hyvote/plugins/votifier/HytaleVotifierPlugin.java</files>
  <action>
Add field `private WebServerPlugin webServerPlugin` to HytaleVotifierPlugin.

Create private method `initializeWebServer()`:
1. Use PluginManager.get().getPlugin(new PluginIdentifier("Nitrado", "WebServer"))
2. Check if result instanceof WebServerPlugin, store in field
3. If not available, log SEVERE warning "WebServer plugin not found - HTTP endpoints disabled"
4. Return early if webServerPlugin is null (graceful degradation)

Call initializeWebServer() in setup() AFTER initializeKeys() - keys must be available before endpoints.

Required imports:
- com.hypixel.hytale.common.plugin.PluginIdentifier
- com.hypixel.hytale.server.core.plugin.PluginManager
- net.nitrado.hytale.plugins.webserver.WebServerPlugin
  </action>
  <verify>Code compiles without errors (check syntax)</verify>
  <done>WebServerPlugin field exists, initializeWebServer() method created and called in setup()</done>
</task>

<task type="auto">
  <name>Task 2: Add servlet registration and cleanup</name>
  <files>src/main/java/org/hyvote/plugins/votifier/HytaleVotifierPlugin.java</files>
  <action>
Create private method `registerServlets()`:
1. Guard: if (webServerPlugin == null) return
2. Register placeholder servlets (to be implemented in 03-02 and 03-03):
   - webServerPlugin.addServlet(this, "/vote", new VoteServlet(this))
   - webServerPlugin.addServlet(this, "/status", new StatusServlet(this))
3. Wrap in try-catch for Exception, log SEVERE on failure
4. Log INFO "Registered HTTP endpoints at /Hyvote/HytaleVotifier/vote and /status"

Call registerServlets() at end of initializeWebServer() (only if webServerPlugin not null).

Update shutdown() method:
1. Guard: if (webServerPlugin != null)
2. Call webServerPlugin.removeServlets(this)
3. Log INFO "Unregistered HTTP endpoints"

Note: VoteServlet and StatusServlet classes don't exist yet - create stub classes in http subpackage (next task).
  </action>
  <verify>Code compiles without errors (check syntax)</verify>
  <done>registerServlets() method created, called in initializeWebServer(), shutdown() cleanup implemented</done>
</task>

<task type="auto">
  <name>Task 3: Create stub servlet classes</name>
  <files>src/main/java/org/hyvote/plugins/votifier/http/VoteServlet.java, src/main/java/org/hyvote/plugins/votifier/http/StatusServlet.java</files>
  <action>
Create http subpackage with two stub servlet classes:

VoteServlet.java:
```java
package org.hyvote.plugins.votifier.http;

import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import org.hyvote.plugins.votifier.HytaleVotifierPlugin;
import java.io.IOException;

public class VoteServlet extends HttpServlet {
    private final HytaleVotifierPlugin plugin;

    public VoteServlet(HytaleVotifierPlugin plugin) {
        this.plugin = plugin;
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws IOException {
        // TODO: Implement in 03-02
        resp.setStatus(HttpServletResponse.SC_NOT_IMPLEMENTED);
        resp.setContentType("text/plain");
        resp.getWriter().println("Vote endpoint not yet implemented");
    }
}
```

StatusServlet.java:
```java
package org.hyvote.plugins.votifier.http;

import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import org.hyvote.plugins.votifier.HytaleVotifierPlugin;
import java.io.IOException;

public class StatusServlet extends HttpServlet {
    private final HytaleVotifierPlugin plugin;

    public StatusServlet(HytaleVotifierPlugin plugin) {
        this.plugin = plugin;
    }

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
        // TODO: Implement in 03-03
        resp.setStatus(HttpServletResponse.SC_NOT_IMPLEMENTED);
        resp.setContentType("text/plain");
        resp.getWriter().println("Status endpoint not yet implemented");
    }
}
```

Add imports to HytaleVotifierPlugin:
- org.hyvote.plugins.votifier.http.VoteServlet
- org.hyvote.plugins.votifier.http.StatusServlet
  </action>
  <verify>Code compiles without errors (check syntax), http package exists with both servlet classes</verify>
  <done>VoteServlet and StatusServlet stub classes created in http subpackage, plugin compiles</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] HytaleVotifierPlugin has webServerPlugin field
- [ ] initializeWebServer() method obtains WebServer plugin reference
- [ ] registerServlets() registers both servlets with WebServer
- [ ] shutdown() calls removeServlets() for cleanup
- [ ] VoteServlet and StatusServlet classes exist in http subpackage
- [ ] All code compiles without syntax errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- WebServer integration wired into plugin lifecycle
- Stub servlets ready for implementation in 03-02 and 03-03
</success_criteria>

<output>
After completion, create `.planning/phases/03-http-endpoints/03-01-SUMMARY.md`
</output>
